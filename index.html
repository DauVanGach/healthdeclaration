<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">
  <head>
    <title>172 - AntiCOVID Health Declaration </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="qrcode.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css">
	<link rel="icon" type="image/png" href="favicon.png"/>
  </head>
  <body>
  <div class="page-all" id="page-all">
	<div class="banner" id="banner-page">
		<img id="favicon" src="favicon.png" alt="172 - AntiCOVID">
		<div class="banner-text-align">
			<div class="bnrtxt" id="banner-text">172 - AntiCOVID Health Declaration</div>
			<div class="bnrtxt" id="banner-text1">Lữ đoàn 172 chung tay đẩy lùi đại dịch COVID-19 </div>
		</div>
	</div>
	<div class="qr" id="qrcodeView"
		<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
			<g id="qrcode"/>
		</svg>
		<div id="qrdescript"> Hãy trình mã này dưới máy quét QR</div>
	</div>
	<div class="main-form">
	<div id ="title-declare" class="title-declare"> TỜ KHAI Y TẾ:</div>
		<form id="declareForm">
			<div class="info">
				<fieldset>
				<legend>Thông tin liên hệ:</legend>
				<div class="group">
					<label for="user" class="label">Họ và tên</label>
					<input id="user" type="text" class="input" placeholder="Tiếng Việt có dấu" autofocus>
				</div>
				<div class="group">
					<label for="birthday" class="label">Năm sinh</label>
					<input id="birthday" type="number" class="input" placeholder="Nhập năm sinh">
				</div>
				<div class="group">
					<label for="sex" class="label">Giới tính</label>
					<input type="radio" name="sex" value="nam" checked> Nam
					<input type="radio" name="sex" value="nu"> Nữ
					<input type="radio" name="sex" value="khac"> Khác
				</div>
				<div class="group">
					<label for="unit_" class="label">Đơn vị</label>
					<input id="unit_" type="text" class="input" placeholder="Từ cấp đại đội" autocomplete>
				</div>
				<div class="group">
					<label for="phoneNumber" class="label">Số điện thoại</label>
					<input id="phoneNumber" type="tel" class="input" autocomplete>
				</div>
				</fieldset>
			</div>
			<div class = "declare">
				<div class="group">
					<label for="vacInject" class="label">Bạn đã tiêm vắc xin</label>
					<input type="radio" name="vacInject" value="chua" checked> Chưa
					<input type="radio" name="vacInject" value="roi"> Rồi
				</div>
				<div class="group">
				<label for="vacInjected" class="label">Loại vắc xin đã tiêm</label>
				<input id="vactypeInput" class="input" list="vactype">
				<datalist class="datalist" id="vactype">
				<option value="Moderna">
				<option value="SputnicV">
				<option value="AstraZeneca">
				<option value="NanoCovax">
				<option value="SinoVax">
				</datalist>
				</div>
				<div class="group">
					<label for="symptoms" class="label">Sốt, ho, khó thở, đau họng, viêm phổi?</label>
					<input type="radio" name="symptoms" value="khong" checked> Không
					<input type="radio" name="symptoms" value="co"> Có
				</div>
				
				<fieldset>
				<legend>Thông tin tiếp xúc</legend>
				<div class="group">
					<div id="fieldDeclarre">
						Thời gian:<input id="timeContact11" type="number" class="input" placeholder="Từ giờ" min="0" max="23">
						<input id="dateContact11" type="date" class="input" placeholder="Ngày">
						<input id="timeContact12" type="number" class="input" placeholder="Đến giờ" min="0" max="23">
						<input id="dateContact12" type="date" class="input" placeholder="Ngày">
						<input id="persionContact1" type="text" class="input" placeholder="Tiếng Việt có dấu">
						<button id="removeField" type="button" class="button"> Xóa khai báo này</button>
					</div>
				</div>
				<div id="newField"></div>
				<button id="addField" type="button" class="button"> Thêm khai báo </button>
				</fieldset>
				
			</div>
		
		</form>
		<div class="button-control">
					<button id="btnDeclare" class="button" type="button" onclick="declareFunction()">Tạo mã</button>
					<button id="btnReDeclare" class="button" type="button" onclick="reDeclareFunction()">Sửa lời khai</button>
					<button id="btnReset" class="button" type="button" onclick="resetFunction()">Nhập lại</button>
		</div>
	</div>		
	</div>
	<script type="text/javascript">
		var qrcode = new QRCode(document.getElementById("qrcode"),{
		width : 300,
		height : 300,
		useSVG: true
		});
		var x = 1;

  function makeCode () {		
		var alterText = "Tờ khai y tế \n";
		var filedContactIf = ''; // Giá trị lưu biến nơi tiếp xúc
		var userText =  document.getElementById("user");
		var birthdayText =  document.getElementById("birthday");
		//var sexText =  document.getElementByName("sex");
		//var rank_Text =  document.getElementById("rank_");
		//var position_Text =  document.getElementById("position_");
		var unit_Text =  document.getElementById("unit_");
		var phoneNumberText =  document.getElementById("phoneNumber");
		var vacTypeText =  document.querySelector('#vactypeInput').value;
		if(!vacTypeText) vacTypeText = "";
		
		alterText = alterText + userText.value + birthdayText.value.toString() + $("input[type='radio'][name='sex']:checked").val() + unit_Text.value + phoneNumberText.value.toString() + $("input[type='radio'][name='vacInject']:checked").val() + vacTypeText + $("input[type='radio'][name='symptoms']:checked").val();
		
		if(x >= 0){
			for(let  i = 0; i <= x;i++){
				filedContactIf = 	filedContactIf + document.getElementById("timeContact"+ x +"1").value.toString() + "&" +
									document.getElementById("dateContact"+ x +"1").value.toString() + "&" +
									document.getElementById("timeContact"+ x +"2").value.toString() + "&" +
									document.getElementById("dateContact"+ x +"2").value.toString() + "&";
			}
		}
		
		alterText = alterText + filedContactIf;
		if (!alterText) {
			alert("Input a text");
			return;
		}

      qrcode.makeCode(alterText);
  }
	
 // makeCode();
  function declareFunction(){
	var qrcodeView = document.getElementById("qrcodeView");
	var formView = document.getElementById("declareForm");
	var qrdescript = document.getElementById("qrdescript");
	var titleDeclare = document.getElementById("title-declare");
	makeCode();
	formView.style.display = "none"
	qrcodeView.style.display = "block";
	titleDeclare.style.display = "none";
	
  }
  
  function  resetFunction(){
	var qrcodeView = document.getElementById("qrcodeView");
	var formView = document.getElementById("declareForm");
	document.getElementById("declareForm").reset();
	qrcodeView.style.display = "none";
	formView.style.display = "block"
  }
  
  function reDeclareFunction(){
	var qrcodeView = document.getElementById("qrcodeView");
	var formView = document.getElementById("declareForm");
	//document.getElementById("declareForm").reset();
	qrcodeView.style.display = "none";
	formView.style.display = "block"
  }
  // add filed
	$("#addField").click(function () {
		if(x >= 0) x++;
		var html = '';
			html += '<div id="fieldDeclarre">';
			html += '<input id="timeContact' + x + '1" type="number" class="input" placeholder="Từ giờ" min="0" max="23">';
			html += '<input id="dateContact' + x + '1" type="date" class="input" placeholder="Ngày">';
			html += '<input id="timeContact' + x + '2" type="number" class="input" placeholder="Đến giờ" min="0" max="23">';
			html += '<input id="dateContact' + x + '2" type="date" class="input" placeholder="Ngày">';
			html += '<input id="persionContact' + x + '" type="text" class="input" placeholder="Tiếng Việt có dấu">';
			html += '<button id="removeField" type="button" class="button"> Xóa khai báo này</button>';
			html += '</div>';
			html += '</div>';
			
		$('#newField').append(html);
		});

        // remove field
        $(document).on('click', '#removeField', function () {
			if(x >= 0){	//Check number of field
				x--;
				$(this).closest('#fieldDeclarre').remove();
			}
        });
    </script>
	
  </body>
</html>
